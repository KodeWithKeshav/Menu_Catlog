<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="Author" content="Keshav S">
  </head>
<body>
<select id="adminCanteenSelect">
  <option value="IT">IT Canteen</option>
  <option value="MBA">MBA Canteen</option>
  <option value="Main">Main Canteen</option>
</select>

<div id="adminMenu" style="margin-top: 1rem;"></div>

<script>
async function loadAdminItems(canteen) {
  const res = await fetch(`/admin/${canteen}`);
  const data = await res.json();
  const container = document.getElementById('adminMenu');
  container.innerHTML = '';

  data.forEach(item => {
    const div = document.createElement('div');
    div.style.border = '1px solid #ccc';
    div.style.margin = '8px';
    div.style.padding = '10px';
    div.style.borderRadius = '8px';
    div.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
    div.innerHTML = `
      <h4>${item.name} - ₹${item.price}</h4>
      <label>
        Show on Menu: 
        <input type="checkbox" id="avail-${item._id}" ${item.isAvailable ? 'checked' : ''}>
      </label>
      <label style="margin-left: 15px;">
        Today's Special: 
        <input type="checkbox" id="special-${item._id}" ${item.isSpecialToday ? 'checked' : ''}>
      </label>
    `;

    // Attach event listeners
    setTimeout(() => {
      document.getElementById(`avail-${item._id}`).addEventListener('change', () => {
        const updatedAvailable = document.getElementById(`avail-${item._id}`).checked;
        const updatedSpecial = document.getElementById(`special-${item._id}`).checked;
        toggleItem(item._id, updatedAvailable, updatedSpecial);
      });

      document.getElementById(`special-${item._id}`).addEventListener('change', () => {
        const updatedAvailable = document.getElementById(`avail-${item._id}`).checked;
        const updatedSpecial = document.getElementById(`special-${item._id}`).checked;
        toggleItem(item._id, updatedAvailable, updatedSpecial);
      });
    }, 0);

    container.appendChild(div);
  });
}

async function toggleItem(id, isAvailable, isSpecialToday) {
  const res = await fetch('/toggle', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, isAvailable, isSpecialToday })
  });

  const { success } = await res.json();
  if (!success) {
    alert('❌ Failed to update item status');
  }
}

document.getElementById('adminCanteenSelect').addEventListener('change', (e) => {
  loadAdminItems(e.target.value);
});

// Initial load
loadAdminItems('IT');
</script>
</body>
</html>
